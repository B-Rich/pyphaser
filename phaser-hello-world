#!/usr/bin/env python

""" Hello World implementation with PyPhaser. """

from __future__ import print_function
import os
from phaser import Phase, Phaser

class PrintPhase(Phase):

    def __init__(self, characters):
        self.characters = characters

    def execute(self, character):
        print(character, end='')

    def iter(self):
        return iter(self.characters)

class File(Phase):

    def __init__(self, repeats):
        self.string = "Hello World!"
        self.file_name = "hello.txt"
        self.repeats = repeats
        self.__doc__ = "Write 'Hello World!' to a file %i times " % repeats
        self.description = "File%i" % repeats

    def precondition(self):
        if os.path.exists(self.file_name):
            raise Exception("File '%s' exists!" % self.file_name)

    def preexec(self):
        self.fp = open(self.file_name, 'w')

    def execute(self, _):
        self.fp.write(self.string)
        self.fp.write('\n')

    def postexec(self):
        self.fp.flush()
        self.fp.close()

    def iter(self):
        return iter(range(self.repeats))

class Hello(PrintPhase):
    """ Print 'Hello ' """

    def __init__(self):
        super(Hello, self).__init__("Hello ")

class World(PrintPhase):
    """ Print 'World!' """

    def __init__(self):
        super(World, self).__init__("World!")

    def postexec(self):
        print("")

if __name__ == '__main__':
    phsr = Phaser(phases=[Hello(), World(), File(3)])
    phsr()
